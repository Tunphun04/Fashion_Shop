‚úÖ 1. T·∫°o b·∫£ng categories (ƒëa c·∫•p / multi-level)
CREATE TABLE categories (
    category_id INT AUTO_INCREMENT PRIMARY KEY,
    parent_id INT NULL,
    name VARCHAR(100) NOT NULL,
    slug VARCHAR(150) NOT NULL UNIQUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    -- FK
    CONSTRAINT fk_category_parent
        FOREIGN KEY (parent_id) REFERENCES categories(category_id)
        ON DELETE SET NULL
        ON UPDATE CASCADE
);

CREATE INDEX idx_categories_parent ON categories(parent_id);


‚úî H·ªó tr·ª£ ƒëa c·∫•p
‚úî parent_id t·ª± tham chi·∫øu
‚úî N·∫øu category cha b·ªã xo√° ‚Üí con chuy·ªÉn th√†nh NULL

‚úÖ 2. T·∫°o b·∫£ng brands
CREATE TABLE brands (
    brand_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    slug VARCHAR(255) NOT NULL UNIQUE,
    logo_url VARCHAR(500),
    description TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);


‚úî slug ƒë·ªÉ SEO
‚úî brand ƒë·ªôc l·∫≠p v·ªõi category

‚úÖ 3. T·∫°o b·∫£ng products
CREATE TABLE products (
    product_id INT AUTO_INCREMENT PRIMARY KEY,
    category_id INT NOT NULL,
    brand_id INT NULL,
    name VARCHAR(200) NOT NULL,
    slug VARCHAR(250) NOT NULL UNIQUE,
    description TEXT,
    price DECIMAL(10,2) NOT NULL,
    status ENUM('active', 'inactive', 'draft') DEFAULT 'active',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    CONSTRAINT fk_products_category
        FOREIGN KEY (category_id) REFERENCES categories(category_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,

    CONSTRAINT fk_products_brand
        FOREIGN KEY (brand_id) REFERENCES brands(brand_id)
        ON DELETE SET NULL
        ON UPDATE CASCADE
);

CREATE INDEX idx_products_category ON products(category_id);
CREATE INDEX idx_products_brand ON products(brand_id);


‚úî M·ªói product thu·ªôc 1 category
‚úî C√≥ th·ªÉ c√≥ ho·∫∑c kh√¥ng c√≥ brand
‚úî DELETE CASCADE n·∫øu category xo√° ‚Üí product c≈©ng xo√°

‚úÖ 4. T·∫°o b·∫£ng product_variants

Product c√≥ nhi·ªÅu bi·∫øn th·ªÉ (size / color / stock / SKU)

CREATE TABLE product_variants (
    variant_id INT AUTO_INCREMENT PRIMARY KEY,
    product_id INT NOT NULL,
    sku VARCHAR(100) NOT NULL UNIQUE,
    color VARCHAR(50),
    size VARCHAR(50),
    price DECIMAL(10,2) NOT NULL,
    stock INT DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    CONSTRAINT fk_variant_product
        FOREIGN KEY (product_id) REFERENCES products(product_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE INDEX idx_variant_product ON product_variants(product_id);


‚úî SKU unique
‚úî M·ªói product c√≥ nhi·ªÅu variants
‚úî Stock ƒë∆∞·ª£c qu·∫£n l√Ω ·ªü ƒë√¢y
‚úî Khi xo√° product s·∫Ω xo√° lu√¥n bi·∫øn th·ªÉ

‚úÖ 5. T·∫°o b·∫£ng product_images (nhi·ªÅu ·∫£nh)
CREATE TABLE product_images (
    image_id INT AUTO_INCREMENT PRIMARY KEY,
    product_id INT NOT NULL,
    variant_id INT NULL,
    image_url VARCHAR(500) NOT NULL,
    is_main TINYINT(1) DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_image_product
        FOREIGN KEY (product_id) REFERENCES products(product_id)
        ON DELETE CASCADE,

    CONSTRAINT fk_image_variant
        FOREIGN KEY (variant_id) REFERENCES product_variants(variant_id)
        ON DELETE SET NULL
);

CREATE INDEX idx_image_product ON product_images(product_id);
CREATE INDEX idx_image_variant ON product_images(variant_id);


‚úî ·∫¢nh c√≥ th·ªÉ g·∫Øn v·ªõi product ho·∫∑c variant
‚úî is_main = 1 ‚Üí ·∫£nh ch√≠nh

‚úÖ 6. T·∫°o b·∫£ng inventory_logs (theo d√µi nh·∫≠p/xu·∫•t kho)
CREATE TABLE inventory_logs (
    log_id INT AUTO_INCREMENT PRIMARY KEY,
    variant_id INT NOT NULL,
    change_type ENUM('import', 'export', 'adjustment') NOT NULL,
    quantity INT NOT NULL,
    note VARCHAR(255),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_inventory_variant
        FOREIGN KEY (variant_id) REFERENCES product_variants(variant_id)
        ON DELETE CASCADE
);

CREATE INDEX idx_inventory_variant ON inventory_logs(variant_id);


‚úî Ghi log khi

Nh·∫≠p h√†ng

Xu·∫•t h√†ng

ƒêi·ªÅu ch·ªânh th·ªß c√¥ng (adjust stock)

‚úî Kh√¥ng qu·∫£n l√Ω stock ·ªü ƒë√¢y ‚Üí ch·ªâ log ‚Üí stock n·∫±m ·ªü product_variants

2Ô∏è‚É£ USERS & CUSTOMER
üìå 1. user_roles (n·∫øu mu·ªën ph√¢n quy·ªÅn chi ti·∫øt)

V√≠ d·ª•: admin, customer, staff

CREATE TABLE user_roles (
    role_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT
);

üìå 2. users ‚Äì th√¥ng tin kh√°ch h√†ng / admin
CREATE TABLE users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    role_id INT DEFAULT 1, -- m·∫∑c ƒë·ªãnh l√† customer
    full_name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    phone VARCHAR(20),
    avatar_url VARCHAR(500),
    is_active BOOLEAN DEFAULT TRUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    CONSTRAINT fk_users_role
        FOREIGN KEY (role_id) REFERENCES user_roles(role_id)
);


‚úî L√Ω do d√πng password_hash: b·∫£o m·∫≠t
‚úî role_id li√™n k·∫øt user ‚Üí role (admin, customer)

üìå 3. addresses ‚Äì nhi·ªÅu ƒë·ªãa ch·ªâ c·ªßa 1 user (1:N)
CREATE TABLE addresses (
    address_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,

    fullname VARCHAR(255) NOT NULL,
    phone VARCHAR(20) NOT NULL,
    street VARCHAR(255) NOT NULL,
    district VARCHAR(255) NOT NULL,
    city VARCHAR(255) NOT NULL,

    is_default BOOLEAN DEFAULT FALSE,

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    CONSTRAINT fk_addresses_user
        FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE
);
‚úî M·ªôt user c√≥ th·ªÉ c√≥ nhi·ªÅu ƒë·ªãa ch·ªâ
‚úî ON DELETE CASCADE: n·∫øu user b·ªã xo√° ‚Üí xo√° lu√¥n ƒë·ªãa ch·ªâ

‚úÖ 3Ô∏è‚É£ SHOPPING CART MODULE
üìå 4. carts ‚Äì gi·ªè h√†ng c·ªßa 1 user (1:1)

‚Üí M·ªói user ch·ªâ c√≥ 1 cart (chu·∫©n ecommerce)

CREATE TABLE carts (
    cart_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL UNIQUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    CONSTRAINT fk_carts_user
        FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE
);


‚úî user_id UNIQUE ƒë·∫£m b·∫£o m·ªói user ch·ªâ c√≥ 1 cart.

üìå 5. cart_items ‚Äì danh s√°ch s·∫£n ph·∫©m trong cart (1 cart : nhi·ªÅu item)

‚Üí Li√™n k·∫øt v·ªõi product_variants v√¨ m·ªói item ph·∫£i c√≥ size/color c·ª• th·ªÉ.

CREATE TABLE cart_items (
    cart_item_id INT AUTO_INCREMENT PRIMARY KEY,
    cart_id INT NOT NULL,
    variant_id INT NOT NULL,
    quantity INT NOT NULL CHECK (quantity > 0),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_cart_items_cart
        FOREIGN KEY (cart_id) REFERENCES carts(cart_id)
        ON DELETE CASCADE,

    CONSTRAINT fk_cart_items_variant
        FOREIGN KEY (variant_id) REFERENCES product_variants(variant_id)
);


‚úî N·∫øu xo√° cart ‚Üí xo√° lu√¥n item
‚úî Li√™n k·∫øt product_variants ‚Üí qu·∫£n l√Ω size/color/stock chu·∫©n

‚úÖ 1. CREATE TABLE orders
CREATE TABLE orders (
    order_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    address_id INT NOT NULL,

    total_amount DECIMAL(12,2) NOT NULL DEFAULT 0,
    shipping_fee DECIMAL(12,2) NOT NULL DEFAULT 0,

    status ENUM('pending','paid','shipping','completed','cancelled')
        DEFAULT 'pending',

    payment_method ENUM('cod','credit','momo','zalopay')
        NOT NULL,

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    CONSTRAINT fk_orders_user
        FOREIGN KEY (user_id) REFERENCES users(user_id),

    CONSTRAINT fk_orders_address
        FOREIGN KEY (address_id) REFERENCES addresses(address_id)
);

üîç Gi·∫£i th√≠ch:

status chuy·ªÉn qua c√°c giai ƒëo·∫°n: pending ‚Üí paid ‚Üí shipping ‚Üí completed

payment_method l∆∞u ph∆∞∆°ng th·ª©c ng∆∞·ªùi d√πng ch·ªçn

address_id d√πng ƒë·ªÉ log ƒë·ªãa ch·ªâ giao h√†ng t·∫°i th·ªùi ƒëi·ªÉm checkout

‚úÖ 2. CREATE TABLE order_items
CREATE TABLE order_items (
    order_item_id INT AUTO_INCREMENT PRIMARY KEY,
    order_id INT NOT NULL,
    variant_id INT NOT NULL,

    quantity INT NOT NULL CHECK (quantity > 0),
    price DECIMAL(12,2) NOT NULL,

    CONSTRAINT fk_order_items_order
        FOREIGN KEY (order_id) REFERENCES orders(order_id)
        ON DELETE CASCADE,

    CONSTRAINT fk_order_items_variant
        FOREIGN KEY (variant_id) REFERENCES product_variants(variant_id)
);

üîç Gi·∫£i th√≠ch:

price l√† gi√° t·∫°i th·ªùi ƒëi·ªÉm ƒë·∫∑t (gi√° trong t∆∞∆°ng lai thay ƒë·ªïi kh√¥ng ·∫£nh h∆∞·ªüng)

ON DELETE CASCADE: xo√° order th√¨ item c≈©ng xo√° theo

‚úÖ 3. CREATE TABLE payments
CREATE TABLE payments (
    payment_id INT AUTO_INCREMENT PRIMARY KEY,
    order_id INT NOT NULL,

    amount DECIMAL(12,2) NOT NULL,
    method ENUM('cod','credit','momo','zalopay') NOT NULL,

    transaction_id VARCHAR(255),
    status ENUM('pending','success','failed') DEFAULT 'pending',

    paid_at DATETIME,

    CONSTRAINT fk_payments_order
        FOREIGN KEY (order_id) REFERENCES orders(order_id)
        ON DELETE CASCADE
);

üîç Gi·∫£i th√≠ch:

M·ªôt order c√≥ th·ªÉ c√≥ nhi·ªÅu payment (retry nhi·ªÅu l·∫ßn)

transaction_id d√πng cho MoMo/ZaloPay/VNPAY

‚úÖ 4. CREATE TABLE shipping
CREATE TABLE shipping (
    shipping_id INT AUTO_INCREMENT PRIMARY KEY,
    order_id INT NOT NULL,

    carrier_name VARCHAR(255) NOT NULL,
    tracking_number VARCHAR(255),
    shipping_fee DECIMAL(12,2) NOT NULL DEFAULT 0,

    status ENUM('pending','shipped','delivered','cancelled')
        DEFAULT 'pending',

    shipped_at DATETIME,

    CONSTRAINT fk_shipping_order
        FOREIGN KEY (order_id) REFERENCES orders(order_id)
        ON DELETE CASCADE
);

5Ô∏è‚É£ REVIEWS & WISHLIST
1. reviews ‚Äì ƒë√°nh gi√° s·∫£n ph·∫©m
CREATE TABLE reviews (
    review_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    product_id INT NOT NULL,

    rating INT NOT NULL CHECK (rating BETWEEN 1 AND 5),
    comment TEXT,

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    CONSTRAINT fk_reviews_user
        FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE,

    CONSTRAINT fk_reviews_product
        FOREIGN KEY (product_id) REFERENCES products(product_id)
        ON DELETE CASCADE
);

‚úî Gi·∫£i th√≠ch:

M·ªói user ƒë√°nh gi√° m·ªôt product.

Khi xo√° user/product ‚Üí x√≥a review theo.

2. wishlist ‚Äì danh s√°ch y√™u th√≠ch c·ªßa user (1 user : 1 wishlist)
CREATE TABLE wishlist (
    wishlist_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL UNIQUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_wishlist_user
        FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE
);

‚úî M·ªói user ch·ªâ c√≥ 1 wishlist, n√™n d√πng UNIQUE.
3. wishlist_items ‚Äì s·∫£n ph·∫©m trong wishlist (1 wishlist : N items)
CREATE TABLE wishlist_items (
    wishlist_item_id INT AUTO_INCREMENT PRIMARY KEY,
    wishlist_id INT NOT NULL,
    product_id INT NOT NULL,
    added_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_wishlist_items_wishlist
        FOREIGN KEY (wishlist_id) REFERENCES wishlist(wishlist_id)
        ON DELETE CASCADE,

    CONSTRAINT fk_wishlist_items_product
        FOREIGN KEY (product_id) REFERENCES products(product_id)
        ON DELETE CASCADE
);

‚úÖ 6Ô∏è‚É£ PROMOTIONS / DISCOUNTS
1. coupons ‚Äì l∆∞u m√£ gi·∫£m gi√°
CREATE TABLE coupons (
    coupon_id INT AUTO_INCREMENT PRIMARY KEY,
    code VARCHAR(100) NOT NULL UNIQUE,

    discount_type ENUM('percentage','fixed') NOT NULL,
    discount_value DECIMAL(10,2) NOT NULL,

    valid_from DATETIME NOT NULL,
    valid_to DATETIME NOT NULL,

    usage_limit INT DEFAULT 0,  -- 0 = kh√¥ng gi·ªõi h·∫°n

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

‚úî V√≠ d·ª•:

SALE20 ‚Üí percentage + 20%

GIAM500K ‚Üí fixed + 500000 VND

2. coupon_usage ‚Äì theo d√µi user ƒë√£ d√πng coupon
CREATE TABLE coupon_usage (
    usage_id INT AUTO_INCREMENT PRIMARY KEY,
    coupon_id INT NOT NULL,
    user_id INT NOT NULL,
    order_id INT,   -- optional, v√¨ c√≥ th·ªÉ √°p d·ª•ng khi thanh to√°n

    used_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_coupon_usage_coupon
        FOREIGN KEY (coupon_id) REFERENCES coupons(coupon_id)
        ON DELETE CASCADE,

    CONSTRAINT fk_coupon_usage_user
        FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE,

    CONSTRAINT fk_coupon_usage_order
        FOREIGN KEY (order_id) REFERENCES orders(order_id)
        ON DELETE SET NULL
);